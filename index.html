<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>摘む人</title>
<link href="https://fonts.googleapis.com/css2?family=BIZ+UDMincho&family=Sawarabi+Gothic&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    font-family: 'BIZ UDMincho', serif;
    background-color: #f0f0f0;
  }

  /* ページタイトル */
  .page-title {
    font-family: 'BIZ UDMincho', serif;
    font-size: 2.2em;
    text-align: center;
    margin: 1em 0;
  }

  section {
    padding: 3em 1em;
  }

  h2 {
    text-align: center;
    font-family: 'BIZ UDMincho', serif;
    margin-bottom: 1em;
  }

  /* ハンバーガー */
  .menu-btn {
    position: fixed;
    top: 15px;
    left: 20px;
    z-index: 1000;
    cursor: pointer;
  }
  .menu-btn div {
    width: 25px;
    height: 3px;
    background: #000;
    margin: 5px;
    transition: 0.4s;
  }
  .menu-btn.open div:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }
  .menu-btn.open div:nth-child(2) {
    opacity: 0;
  }
  .menu-btn.open div:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
  }

  /* メニュー */
  .menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #fff;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 999;
  }
  .menu a {
    font-size: 1.5em;
    padding: 1em;
    text-decoration: none;
    color: #000;
    border-top: 1px solid #ccc;
    width: 100%;
    text-align: center;
  }
  .menu a:last-child {
    border-bottom: 1px solid #ccc;
  }

  /* Gallery */
  #image-list {
    column-count: 2;
    column-gap: 1em;
  }
  .image-item {
    break-inside: avoid;
    margin-bottom: 1em;
  }
  .image-item img {
    max-width: 100%;
    opacity: 0;
    transition: opacity 1.2s ease-in;
  }
  .image-item img.loaded { opacity: 1; }
  .info {
    text-align: center;
    font-family: 'Sawarabi Gothic', sans-serif;
    margin-top: 0.3em;
    font-size: 0.9em;
  }
  .info .title { font-weight: bold; display: block; }
  .info .nickname { color: #555; display: block; }

  .more-link {
    display: block;
    text-align: center;
    margin-top: 1em;
    font-family: 'Sawarabi Gothic', sans-serif;
  }

  /* About */
  #about img {
    display: block;
    max-width: 100%;
    margin: 0 auto;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }

  /* Credit */
  #credit {
    font-family: 'Sawarabi Gothic', sans-serif;
    line-height: 1.6;
    max-width: 600px;
    margin: 0 auto;
  }
</style>
</head>
<body>

<!-- ページタイトル -->
<h1 class="page-title">摘む人</h1>

<!-- ハンバーガー -->
<div class="menu-btn" id="menu-btn">
  <div></div><div></div><div></div>
</div>
<div class="menu" id="menu">
  <a href="#gallery">Gallery</a>
  <a href="#about">About</a>
  <a href="#credit">Credit</a>
</div>

<!-- Gallery -->
<section id="gallery">
  <h2>Gallery</h2>
  <div id="image-list"></div>
  <a href="gallery.html" class="more-link">もっと見る</a>
</section>

<!-- About -->
<section id="about">
  <h2>About</h2>
  <img src="摘む人キービジュアル最新３.jpg" alt="ポスター">
</section>

<!-- Credit -->
<section id="credit">
  <h2>Credit</h2>
  <p>
    ...既存の内容...
  </p>
</section>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://hrtuyjkbchlkxzkzltak.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
);
const bucketName = "images";

async function loadImages() {
  const imageList = document.getElementById("image-list");
  imageList.innerHTML = "";
  const { data, error } = await supabase
    .from("posts")
    .select("*")
    .order("id", { ascending: false })
    .limit(6);
  if (error) return;
  for (const post of data) {
    const { data: urlData } = supabase.storage.from(bucketName).getPublicUrl(post.image_name);
    const wrapper = document.createElement("div");
    wrapper.className = "image-item";
    const img = document.createElement("img");
    img.src = urlData.publicUrl;
    img.onload = () => img.classList.add("loaded");
    const info = document.createElement("div");
    info.className = "info";
    info.innerHTML = `<span class="title">${post.title}</span><span class="nickname">${post.nickname}</span>`;
    wrapper.appendChild(img);
    wrapper.appendChild(info);
    imageList.appendChild(wrapper);
  }
}
loadImages();

// ハンバーガー
const menuBtn = document.getElementById("menu-btn");
const menu = document.getElementById("menu");
menuBtn.addEventListener("click", () => {
  menuBtn.classList.toggle("open");
  menu.style.display = menu.style.display === "flex" ? "none" : "flex";
});

// メニュー内リンクタップで閉じつつスクロール
document.querySelectorAll(".menu a").forEach(link => {
  link.addEventListener("click", e => {
    e.preventDefault();
    const targetId = link.getAttribute("href").substring(1);
    const targetSection = document.getElementById(targetId);
    if (targetSection) {
      targetSection.scrollIntoView({ behavior: "smooth" });
    }
    // メニューを閉じる
    menuBtn.classList.remove("open");
    menu.style.display = "none";
  });
});
</script>

</body>
</html>